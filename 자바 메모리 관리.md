# 자바 메모리 관리

- contents
    - Java의 Stack과 Heap

### Java의 Stack과 Heap

![Stack&Heap](https://s3.ap-northeast-2.amazonaws.com/yaboong-blog-static-resources/java/javamemory-stack-and-heap-dzone.jpg)
*Image from 'https://dzone.com/articles/java-memory-management'*

#### Stack
- Heap 영역에 생성된 Object 타입의 데이터의 참조값이 할당된다.
- 원시타입의 데이터가 값과 함께 할당된다.
- 지역변수들은 scope에 따른 visibility를 가진다.
- 각 Thread는 자신만의 Stack을 가진다.

Stack에는 Heap 영역에 생성된 Object 타입의 데이터들에 대한 참조를 위한 값들이 할당된다. 또한, 원시타입(primitive type) - byte, short, int, long, double, float, boolean, char 타입의 데이터들이 할당된다. 이 때 원시타입의 데이터들에 대해서는 참조값을 저장하는 것이 아니라 실제 값을 stack에 직접 저장하게 된다.

Stack 영역에 있는 변수들은 visibility를 가진다. 변수 scope에 대한 개념이다. 전역변수가 아닌 지역변수가 foo()라는 함수 내에서 Stack에 할당된 경우, 해당 지역변순느 다른 함수에서 접근할 수 없다. 예를 들어, foo()라는 함수에서 bar()함수를 호출하고 bar()함수의 종료되는 중괄호 } 가 실행된 경우(함수가 종료된 경우), bar() 함수 내부엣 선언한 모든 지역변수들은 stack에서 pop되어 사라진다.

Stack 메모리는 Thread 하나당 하나씩 할당된다. 즉, 쓰레드 하나가 새롭게 생성되는 순간 해당 스레드를 위한 stack도 함께 생성되며, 각 쓰레드에서 다른 쓰레드의 stack 영역에는 접근할 수 없다.

#### Heap
- Heap 영역에는 주로 긴 생명주기를 가지는 데이터들이 저장된다. (대부분의 오브젝트는 크기가 크고, 서로 다른 코드블럭에서 공유되는 경우가 많다.)
- 애플리케이션의 모든 메모리 중 stack에 있는 데이터를 제외한 부분이라고 보면 된다.
- 모든 Object타입(Integer, String, ArrayList ...)은 Heap영역에 생성된다.
- 몇 개의 쓰레드가 존재하든 상관없이 단 하나의 Heap영역만 존재한다.
- Heap영역에 있는 오브젝트들을 가리키는 레퍼런스 변수가 stack에 올라가게 된다.
- **String과 모든 Wrapper 클래스는 Immutable이다. 그래서 Heap에 같은 오브젝트를 레퍼런스 하고 있는 경우라도, 새로운 연산이 적용되는 순간 새로운 오브젝트가 Heap에 새롭게 할당된다.**

### 참고
- https://yaboong.github.io/java/2018/05/26/java-memory-management/