# 교착상태(DeadLock)

### 프로세스는 실행을 위해 여러 자원을 필요로 한다.

---

- CPU, 메모리, 파일, 프린터 ...
- 어떤 자원은 가지고 있지만 다른 자원을 갖지 못할 때(다른 프로세스가 사용 중) 대기해야 함
- 다른 프로세스 역시 다른 자원을 가지려고 대기할 때 교착상태 가능성이 있음

### 교착상태 필요조건

---

- 상호배타
- 보유 및 대기
- 비선점
- 환형대기(자원 할당도 상에 원이 만들어져야 함)
    - 충분 조건은 아님
- 예
    - 식사하는 철학자 문제
        - 철학자들이 동시에 배가 고플 때
        - 그런일은 잘 일어나지 않음
        - 해결 : 짝수번 철학자는 왼쪽 젓가락 잡고, 오른쪽 젓가락 잡음, 홀수번 철학자는 오른쪽 젓가락 잡고, 왼쪽 젓가락 잡음

### 교착상태 처리

---

- 교착상태 방지(DeadLock Prevention)
    - 교착상태 4가지 필요조건 중 한 가지 이상 불만족시키는 것
        - 상호배타
            - 자원을 공유 가능하게 함, 원천적으로 불가능 할수도
            - 어느 한 순간에 cpu를 동시에 사용할 수 없음, 메모리도 ...
            - 읽어내기만 하는 파일은 공유 가능
            - 교착상태 방지에 부적절
        - 보유 및 대기
            - 자원을 가지고 있으면서 다른 자원을 기다리지 못하게 함
            - 식사하는 철학자 같은 경우에는 동시에 잡도록, 하나만 잡고 있지 못하도록
            - 왼쪽 젓가락 잡고, 오른쪽 젓가락을 잡으려고 할 때, 오른쪽 젓가락이 없으면 왼쪽 젓가락을 놓아버림
            - 단점 : 자원 활용을 저하, 기아(프로세스가 진행을 못할 확률이 높아짐)
            - 상호배타에 비해 가능한 방
        - 비선점
            - 일반적으로 불가능
            - 예) 프린터를 남이 사용하고 있는데, 뺏아오면 엉망이 됨, cpu 같은 경우는 가능할수도(억지로 콘텍스트 스위칭을 시킴)
        - 환형 대기
            - 일반적으로 환형 대기를 깨는 법은 자원에 번호를 부여하고, 자원 번호에 오름차순으로 자원을 요청하도록 함
                - 식사하는 철학자에도 적용 가능
                - 젓가락에 번호를 부여, 철학자는 번호가 낮은 젓가락부터 잡음
            - 단점 : 자원활용을 저하
        - 주로 보유 및 대기나 환형 대기를 깸
- 교착상태 회피(DeadLock Avoidance)
    - 교착상태 = 자원 요청에 대한 잘못된 승인(= 은행 파산)
        - 고객, 현금들이 있음, 주로 돈을 빌려주는 은행들에 해당
        - 손님들에게 돈을 잘 나눠주면 이익, 잘못 나눠주면 부도(DeadLock)
    - 안전한 할당
    - 불안전한 할당 = 교착상태
    - 불안전한 할당을 하지 않게
- 교착상태 검출 및 복구
    - OS로 하여금 데드락이 일어나지 않게 하는 것이 아니라, 자원을 다 나눠주고, 잘 안일어나지만 어쩌다 교착상태가 발생하면 시스템이 동작을 안하고, 이를 해결하기 위해 OS의 프로세스 관리 부서에서 데드락이 일어났는가, 일어나지 않은가를 주기적으로 검사함
    - 교착상태 발생 시 복구
    - 검사에 따른 추가 부담이 크다(계산, 메모리)
    - 복구하려면 주기적으로 현재 상태를 기억해둬야 함. 기억해두려면 메모리가 듬(비용이 많이 듬), 가능할 때도 있겠지만, 불가능할 때도 있음
    - 자원을 강제로 뺏아서 해결이 필요한 프로세스에게 전달
- 교착상태 무시
    - 잘 일어나지 않기 때문에
    - PC 같은 경우 충분히 사용할 수 있는 방법임

### 정리

---

- 컴퓨터에서 가장 중요한 자원은 CPU
- OS에서 CPU를 관리하는 부서는 프로세스 MGMT 부서
- CPU 시간을 제어하는 부서는 프로세스 MGMT 안의 CPU Scheduling 부서
- 프로세스들이 자원을 요청할 때 해결하는 것은 프로세스 동기화
    - 세마포(소프트웨어 도구)
    - 데드락(어느 자원을 가지고 있지만 다른 자원을 가지지 못해 실행되지 못하는 것)
- 다음으로 중요한 부분은 메모리 관리