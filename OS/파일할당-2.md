# 파일 할당-2

- 디스크는 ? pool of free blocks
- 파일 할당
    - 만약 파일이 5kb고, 블록이 1kb이면(보통은 더 크다) → 다섯개의 블록이 필요
    - 연속 할당
        - 각 파일에 대해 디스크 상에 연속된 블록을 할당
        - 장점 : 디스크 헤더의 이동 최소화 = 빠른 i/o 성능
        - 동영상, 음악, VOD에 적합
        - 순서적으로 읽을 수도 있고(순차 접근, sequential access)
        - 특정 부분을 바로 읽을 수도 있다.(직접 접근, direct access)
        - 디렉토리
            - 파일에 대한 정보를 모아둔 테이블
            - 파일의 시작 블록 번호
        - 단점?
            - 현재는 거의 사용되지 않는다.
            - 파일을 지울 경우 문제가 발생
            - 삭제 시 곳곳에 hole이 흩어짐
            - 새로운 파일을 어느 hole에 넣을 것인가?
            - 외부 단편화로 인한 디스크 공간 낭비
                - Compaction 할 수 있지만 시간 오래 걸림
            - 파일 생성 당시 이 파일의 크기를 알 수 없음
            - 파일의 크기가 계속 증가할 수 있음(log file) → 기존의 hole 배치로는 불가
            - 어떻게 해결할 수 있을까? 연결 할당
    - 연결 할당
        - 파일 = linked list of data blocks
        - 시작 블록은 파일 디렉토리에 저장
        - 각 블록에 다음 블록에 대한 시작 주소가 저장
        - 따라서 파일들이 아무데나 들어갈 수 있음
        - 각 블록은 포인터 저장을 위한 4바이트 또는 이상 소모
        - 새로운 파일 만들기
            - 비어있는 임의의 블록을 첫 블록으로
            - 파일이 커지면 다른 블록을 할당 받고 연결
            - 외부단편화 없음!
                - 외부단편화는 디스크 용량이 있어도 연속하지 않아 저장하지 못하는 것이기 때문
            - 단점
                - 순서대로 읽기(Sequential access)
                - Direct Access 불가 →  중간부터 읽기 불가 ( ex) 동영상을 중간부터 볼 수 없음)
                - 포인터 저장을 위해 4바이트 이상 손실
                - 낮은 신뢰성 : 포인터 끊어지면 이하 접근 불가
                - 느린 속도: 헤더의 움직임
            - 개선: FAT 파일 시스템
                - File Allocation Table 파일 시스템
                - 포인터들만 모은 테이블(FAT)를 별도 블록에 저장
                - FAT 손실 시 복구 위해 이중 저장
                - Direct Access 가능
                - FAT는 일반적으로 메모리 캐싱(부팅 시 메모리에 올림)
                - 속도는 느림 → 외부 단편화 문제를 해결하기 위해 나온 것이기 때문에
                - 16bit 할당하면 FAT16, 2^16, 32bit 할당하면 FAT32, 2^32개 할당 가능
    - 색인 할당
        - Unix, Linux에서 사용됨
        - 파일 당 (한 개의) 인덱스 블록 → 데이터 블록 외에
        - ...